<div align="center">
    <img src="https://hackmd.io/_uploads/rJ6x4Bf00.png" width="200" alt="TWSE">
</div>

# 證交所網站地圖爬蟲
![gh](https://raw.githubusercontent.com/SeanChenR/img_gif/main/myimage/1727936472000o3zwul.png)

## Python 環境 & 套件

![Static Badge](https://img.shields.io/badge/3.11.9-F7D754?style=for-the-badge&logo=python&label=Python&labelColor=black)

```Python
pip install -r requirements.txt
```

---

## 程式簡介
<font color="#00b0f0">程式分為三個部分，分別為 sitemap_info 和 sitemap_attachment_info / sitemap_column_info 和 compare 的部分</font>

| 網站地圖類型                                          | 任務描述                                                         | 產出檔案名稱                                                                                                                     | 產出檔案資料夾                       | 產出檔案描述                                         |
| ----------------------------------------------- | ------------------------------------------------------------ | -------------------------------------------------------------------------------------------------------------------------- | ----------------------------- | ---------------------------------------------- |
| sitemap_info                                    | 抓取完整MAP_ROUTE，並儲存網站地圖網址與API網址。另外要判斷網頁中是否有下拉式選單、表格、網頁載點和附檔載點。 | 1. output_{當天日期+十分秒}.xlsx<br>2. output_api_{當天日期+十分秒}.xlsx<br>3. output_link.xlsx                                          | 1. table<br>2. api<br>3. link | 1. 瑞齊要的檔案<br>2. 儲存API網址的檔案<br>3. 儲存所有網站地圖網址的檔案 |
| sitemap_columns_info<br>sitemap_attachment_info | 若是網頁中有表格的，型態設為T，會抓取表格名稱和表格欄位名稱；若是網頁中有附檔載點的，型態設為A，會抓取該附檔的檔案名稱 | columns_info_{當天日期+十分秒}.xlsx                                                                                               | columns_attachment            | 包涵所有Type為T和A的資訊                                |
| compare                                         | 會比較最新和第二新的檔案                                                 | 1. output_table_compare_{當天日期+十分秒}.xlsx<br>2. column_info_compare_{當天日期+十分秒}.xlsx<br>3. attachment_compare_{當天日期+十分秒}.xlsx | compare                       | table, columns, attachment 的比較檔案會分別產出          |

### <font color="#e36c09">sitemap info</font>

- **`twse_main_code.py`** 主程式：串接以下程式，寫下拉式選單的判斷式，每個網頁的下拉式選單個數不同，若當年、當月、當日、當週沒資料時，往回取一個單位、判別是否有股票輸入格等等。
  - **def web_process**：串接所有 Functions 的函式，會先判斷是否有 API 網址。若有的話會將取得的 API 相關參數組合成 API 網址，然後對 API 網址 Requests 然後判斷我們所需要的資訊；若沒有 API 的話，會直接對網頁進行 Requests 然後判斷我們需要的資訊。
  - **def database**：將整理爬蟲抓回來整理好的資訊儲存成 excel 檔，Error 的網址會寫入 links_special.txt。
  - **def check_file**：將 links_special.txt 中的網址再最後重新抓一次。

- **`identify_date_select.py`** 回傳處理完的日期與下拉式選單，會判斷總共有幾個選擇，將需要的參數以dict方式回傳。
	- **def flatten_dict**：用於將兩個長度相同的 list 組合起來變成 dict。
	- **def identify_date_select**：這個函式最主要是判斷日期參數和下拉式選單參數，我將以幾個網頁作為範例，[請前往 API 參數範例查看](#api-參數範例)。

- **`date_params.py`** 會將上面的 dict 日期的部分整理成 API 網址的樣式，和分類此日期屬於哪種。
    - **def get_date_interval**：將取得的日期參數整理起來，並判斷說他是屬於那種日期型態，目前總共有以下五種：

		| interval | none | MWD    | else                | exception_url |
		| -------- | ---- | ------ | ------------------- | ------------- |
		| 日期區間     | 沒有日期 | 有月週日選項 | 單一日期選項，年月日->日，年月->月 | 例外處理          |

- **`exception_url.py`** 例外處理的網頁，函數名字根據網頁title命名，目前只有一個例外。
  - **def Stock_Selection_Criteria**：這個函式是處理例外網頁，目前只有有一個例外網頁是 [上市公司>>上市公司條件選股](https://www.twse.com.tw/zh/listed/selection-criteria.html)，因為這個網頁他需要用 Selenium 點擊的方式才可以取得所以的下拉式選單參數。

- **`enter_coid.py`** 需要輸入股票代碼時，使用這個檔案內的股票代碼，新增刪除修改皆從這程式進行。
  - **def enter_coid**：有股票輸入格的網頁會從這邊讀取要輸入的股票代碼，目前是 `1101`, `1213`

- **`handle_api.py`** 取得 API 與將 API 與相關參數組合成 API URL。
  - **def get_api**：從網頁中試圖取得網頁 API，基本上是有表格的網頁才會有 API。
  - **def api_url_generator**：將 API 和相關的參數組合成 API URL，args 可以傳入無限多個參數，在函式中 args 他就是一個 list。組合成 API URL 的規則是第一個參數是用 `?` 跟 API 連接，其餘參數與參數的串接是用 `&`。

- **`get_api_JsonData.py`** 對 API URL requests，並取得 data, fields, status欄位。
  - **def get_api_Data**：這個函式是對 API URL 進行 Requests，然後取得裡面的 Json 資料。基本上以 Status 來進行初步判斷，會有三種可能：

	| Status | Describe                                          | Process                                                                                                                                                            |
	| ------ | ------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
	| OK     | 代表有表格欄位可以撈，但不代表表格中有資料。                            | API 網址中會以 Json 形式呈現，會取得其中的 data 欄位來判斷表格是否有資料。<br>Ex : [交易資訊>>融資融券與可借券賣出額度>>調整成數>>查詢範圍：全部上市>>調整成數原因：TDR兌回異常](https://www.twse.com.tw/zh/trading/margin/bfib9u.html) |
	| 請重新查詢! | 代表日期超出初始日期，需要進行重新設定，目前皆只有在日期區間的網站才會出現，他這段會給予初始日期。 | 會將 Status 給予的初始日期替換掉原本的。<br>Ex : [交易資訊>>盤後資訊>>暫停交易證券](https://www.twse.com.tw/zh/trading/historical/twtawu.html)                                                   |
	| 很抱歉    | 代表此網頁的表格沒資料。                                      | 會直接回傳空值。<br>Ex : [交易資訊>>盤後資訊>>盤後定價交易>>分類：封閉式基金](https://www.twse.com.tw/zh/trading/historical/bfi41u.html)                                                         |


- **`sitemap_content.py`** 把取回的相關資訊放進 dataframe & MAP ROUTE 的整理。
  - **def crawler_content**：一般有 form 的或者有 API 的都會用這個函數。
  - **def def_crawler_content_with_table**：沒有 form 下拉選單的，用這個函數，table 可以一起判斷，會用 no_form 是因為即使沒有下拉選單，但是 form 這個 css selector 還是在，會有判斷錯誤的可能。

- **`date_handler.py`** 處理需要往前取資料的程式，前一年、前一個月、前一週、前一個工作日。
  - **class DateHandler**：傳入一個年月日的日期(西元年)，再根據需求抓前一年、前一個月、前一週、前一個工作天，使用方式如下：
    - 使用物件並傳入隨便一個日期：`date_handler = DateHandler("20240523")`

		| 功能          | 語法                                          | 結果                   |
		| ----------- | ------------------------------------------- | -------------------- |
		| 抓前一個月的一號    | previous_month = date_handler.previous_mm() | 20240523 -> 20240401 |
		| 抓前一年的同個月的一號 | previous_year = date_handler.previous_yy()  | 20240523 -> 20230501 |
		| 抓前一個週       | previous_week = date_handler.previous_ww()  | 20240523 -> 20240516 |
		| 抓前一個工作日     | date_handler.previous_workday()             | 20240523 -> 20230522 |

- **`tradeday.py`** 判斷前一天是否是工作日，用 TEJ 的 TWN/TRADEDAY_TWSE 資料庫。
  - **def get_tradeday**：進入 `TWN/TRADEDAY_TWSE` 資料庫查詢日期是否為工作日，如果是 0 是假日，其他數字都是工作日。

- **`get_twse_link.py`** 從網站地圖首頁抓取所有的網址，也會抓取每個網頁裡面的 sidebar，會根據抓取的順序一同儲存 MAP_ROUTE。
  - **def process_href**：判斷取得的網址是否為證交所網站地圖內部的網址。
  - **def find_href**：抓取網站地圖首頁中所有的網址。
  - **def find_sidebar_links**：找 `<navigation>` 中衍生的網址，也就是有些網頁中會有側邊欄(sidebar)，會篩選重複的和不是證交所的網頁。
  - **def get_twse_link**：依序執行上面的幾個函式，最後輸出成 excel 檔到 `Web_Route/output/link/output_link.xlsx`。

### <font color="#e36c09">sitemap_columns_info / sitemap_attachment_info</font>

- **`get_file_data.py`** 抓取 Attachment 附件名稱主程式：處理有附檔可以下載的網頁，也就是 `ATTACHMENT_FG=Y` 的，NAME 為檔案的名稱，TYPE 為 A。
  - **def get_file_data**：會判斷要處理的網頁是從 txt 檔來的還是 excel 來的，txt 來的代表是跑第一次時錯誤才會寫入 txt，excel 來的代表是跑第一次的檔案。
  - **def get_latest_api_file**：取得 api 資料夾中最新的 output_api 檔案。

- **`columns_info.py`** 抓取 Columns 欄位名稱主程式：串接以下程式，處理有表格的網頁，也就是 `TABLE_FG=Y` 的，NAME 為表格名稱，COLUMN_NAME 為欄位名稱，TYPE 為 T。
  - **def get_columns_info**：串接所有 Functions 的函式，會讀取網頁網址和 API 的網址，如果沒有 API 網址的話會試著重新抓看看。若有 API 的話會會抓去 API 網頁中的 Fields 欄位，如果是巢狀表格會用 `_` 串接，然後表格名稱和欄位名稱會移除日期等不必要的資料。若網頁中有多個表格則是每個表格的 OD 都重新開始算。
  - **def database**：將整理爬蟲抓回來整理好的資訊儲存成 excel 檔，Error 的網址會寫入 web_special.txt。
  - **def check_file**：將 web_special.txt 中的網址再最後重新抓一次。

- **`handle_api.py`** 取得 API 與將 API 與相關參數組合成 API URL，與 [sitemap info](#sitemap-info) 一樣。
  - **def get_api**：從網頁中試圖取得網頁 API，基本上是有表格的網頁才會有 API。
  - **def api_url_generator**：將 API 和相關的參數組合成 API URL，args 可以傳入無限多個參數，在函式中 args 他就是一個 list。組合成 API URL 的規則是第一個參數是用 `?` 跟 API 連接，其餘參數與參數的串接是用 `&`。

- **`get_api_JsonFields.py`** 對 API URL requests，並取得 data, fields, status欄位。
  - **def get_api_info**：每個網頁的表格數量不一定，所以用這個函數滾動式增加或減少表格數量，三個表格以上的網頁會使用這個函式，但目前這個沒有處理巢狀表格，因為目前三個表格以上的沒有巢狀表格的案例。
  - **def get_api_fields**：會判斷是不是巢狀表格，如果是的話要取得 API 網頁中一些參數來看巢狀表格的位子是幾到幾，如果那個網頁有三個以上的表格的話就會使用 `get_api_info` 函式。

- **`columns_content.py`** 把取回的相關資訊放進 dataframe & MAP ROUTE 的整理。
  - **def crawler_columns_info**：將 `process_tables_columns_info` 所取得的資訊依位置填入 DataFrame 中。
  - **def process_tables_columns_info**：在這邊會將表格名稱和欄位名稱不必要的東西移除，像是日期資訊，然後 OD 順序遞增上去，每個表格 OD 會重新算，依位置填入 DataFrame 中。
  - **def attachment_info**：將 `get_file_data` 所取得的資訊依位置填入 DataFrame 中。

### <font color="#e36c09">compare</font>

- **`twse_compare.py`** 將爬蟲的結果與之前的進行比較，會自動讀取 `table` 和 `columns_attachment` 資料夾中最新的兩個檔案，看有沒有新增的網頁或有沒有什麼網頁被移除或網頁內有沒有什麼更改。
  - **class TWSE_Table_Compare**：新增的網頁填 `I`，消失的填 `D`，TABLE_FG 更動填 `T`，ATTACHMENT_FG 更動填 `A`，FORM_FG 更動填 `F`，CSV_AND_HTML_BUTTON_FG 更動填 `C`。如果 EDITFG 為 `D`，保留 old 欄位，其餘保留 new 欄位。
  - **class TWSE_Columns_Compare**：新增的網頁填 `I`，消失的填 `D`。如果 EDITFG 為 `D`，保留 old 欄位，其餘保留 new 欄位。
  - **class TWSE_Attachment_Compare**：新增的網頁填 `I`，消失的填 `D`。如果 EDITFG 為 `D`，保留 old 欄位，其餘保留 new 欄位。

## 爬蟲結果
### <font color="#e36c09">sitemap info</font>
`output_2024-09-19.xlsx` 這個檔案是截至日期上，所有的 LINK 和 MAP_ROUTE 和其他按鈕幾乎皆以確認過正確，是最完整的一版。

### <font color="#e36c09">sitemap_columns_info / sitemap_attachment_info</font>
`columns_info_2024-09-20.xlsx` 這個檔案是截至日期上，所以網頁的表格名稱和表格欄位名稱都有抓下來，有附檔網頁的文件名稱也都有抓下來，並確認過資料沒問題，是最完整的一版。

## 發生錯誤的處理
### <font color="#e36c09">sitemap info</font>
若有遇到 error，該網址會被存到 `links_special.txt` 這個檔案，沒問題會在最後產出 `output_{today}.xlsx`。

`links_special.txt` 的網址會最後再重新爬一次，目的是確保這個網站在爬蟲的時候被鎖，所以就最後再重新抓一次，如果還是 Error 會被儲存到 `error_log_main.txt` 中。

### <font color="#e36c09">sitemap_columns_info / sitemap_attachment_info</font>
若有遇到 error，該網址會被存到 `web_special.txt` 這個檔案，沒問題會在最後產出 `columns_info_{today}.xlsx`。

`web_special.txt` 的網址會最後再重新爬一次，目的是確保這個網站在爬蟲的時候被鎖，所以就最後再重新抓一次，如果還是 Error 會被儲存到 `error_log_main.txt` 中。

## 爬蟲相關建議
### <font color="#e36c09">sitemap info</font>
在爬蟲時請用 TEJ 的有線內網，才比較不會爬到一半被鎖。然後盡量在半夜進行爬蟲，晚上證交所網頁的 Loading 比較不會那麼重，較不容易出現 Error。最完整測試的版本目前是在晚上 10.～凌晨 4.，過程中皆沒有產生 Error。

### <font color="#e36c09">sitemap_columns_info / sitemap_attachment_info</font>
在爬蟲時請用 TEJ 的有線內網，才比較不會爬到一半被鎖。這個比較不會有時段的限制，但是根據之前經驗是盡量避免收盤的時段，因為那個時段線上人數會比較多。

## 開始爬蟲
### <font color="#e36c09">sitemap info</font>
```Python
python twse_main_code.py
```

### <font color="#e36c09">sitemap_columns_info / sitemap_attachment_info</font>
```Python
python columns_info.py
```

## 比較結果
執行 twse_compare.py，會自動抓取最新的兩個檔案，然後根據要比較的檔案類型，table、columns、attachment 來執行對應的物件，最後產出比較結果的檔案。
```Python
python twse_compare.py
```
## API 參數範例
| MAP_ROUTE + LINK                                                                                  | 網頁API日期參數                                                                                                                                                                                                                                                                | 網頁API下拉式選單參數                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              | 分類                                  | 範例API網址                                                                                                                   |
| ------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ----------------------------------- | ------------------------------------------------------------------------------------------------------------------------- |
| [交易資訊>>盤後資訊>>每日收盤行情](https://www.twse.com.tw/zh/trading/historical/mi-index.html)                 | {'return_D': {'date': '20240926'}, 'return_M': {}, 'return_Y': {}, 'return_W': {}, 'return_A': {}, 'return_MA': {}}                                                                                                                                                      | {'type': {'分類：大盤統計資訊': 'type=MS', '分類：收盤指數資訊': 'type=IND', '分類：委託及成交統計資訊': 'type=MS2', '分類：全部': 'type=ALL', '分類：全部(不含權證、牛熊證、可展延牛熊證)': 'type=ALLBUT0999', '分類：封閉式基金': 'type=0049', '分類：ETF': 'type=0099P', '分類：ETN': 'type=029999', '分類：受益證券': 'type=019919T', '分類：認購權證(不含牛證)': 'type=0999', '分類：認售權證(不含熊證)': 'type=0999P', '分類：牛證(不含可展延牛證)': 'type=0999C', '分類：熊證(不含可展延熊證)': 'type=0999B', '分類：可展延牛證': 'type=0999X', '分類：可展延熊證': 'type=0999Y', '分類：附認股權特別股': 'type=0999GA', '分類：附認股權公司債': 'type=0999GD', '分類：認股權憑證': 'type=0999G9', '分類：可轉換公司債': 'type=CB', '分類：創新板股票': 'type=TIB', '分類：水泥工業': 'type=01', '分類：食品工業': 'type=02', '分類：塑膠工業': 'type=03', '分類：紡織纖維': 'type=04', '分類：電機機械': 'type=05', '分類：電器電纜': 'type=06', '分類：化學生技醫療': 'type=07', '分類：化學工業': 'type=21', '分類：生技醫療業': 'type=22', '分類：玻璃陶瓷': 'type=08', '分類：造紙工業': 'type=09', '分類：鋼鐵工業': 'type=10', '分類：橡膠工業': 'type=11', '分類：汽車工業': 'type=12', '分類：電子工業': 'type=13', '分類：半導體業': 'type=24', '分類：電腦及週邊設備業': 'type=25', '分類：光電業': 'type=26', '分類：通信網路業': 'type=27', '分類：電子零組件業': 'type=28', '分類：電子通路業': 'type=29', '分類：資訊服務業': 'type=30', '分類：其他電子業': 'type=31', '分類：建材營造': 'type=14', '分類：航運業': 'type=15', '分類：觀光餐旅': 'type=16', '分類：金融保險': 'type=17', '分類：貿易百貨': 'type=18', '分類：存託憑證': 'type=9299', '分類：油電燃氣業': 'type=23', '分類：綜合': 'type=19', '分類：綠能環保': 'type=35', '分類：數位雲端': 'type=36', '分類：運動休閒': 'type=37', '分類：居家生活': 'type=38', '分類：其他': 'type=20'}}                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    | 單一日期迭代下拉式選單！<br>-> else             | https://www.twse.com.tw/rwd/zh/afterTrading/MI_INDEX?date=20240926&type=MS                                                |
| [交易資訊>>盤後資訊>>個股日收盤價及月平均價](https://www.twse.com.tw/zh/trading/historical/stock-day-avg.html)       | {'return_D': {}, 'return_M': {'date': '20240926'}, 'return_Y': {}, 'return_W': {}, 'return_A': {}, 'return_MA': {}}                                                                                                                                                      | {'stockNo': {'股票代碼：': 'stockNo='}}                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        | 單一日期迭代股票輸入格！<br>-> else             | https://www.twse.com.tw/rwd/zh/afterTrading/STOCK_DAY_AVG?date=20240926&stockNo=1101                                      |
| [交易資訊>>盤後資訊>>暫停交易證券](https://www.twse.com.tw/zh/trading/historical/twtawu.html)                   | {'return_D': {'startDate': '20110101', 'endDate': '20240926'}, 'return_M': {}, 'return_Y': {}, 'return_W': {}, 'return_A': {}, 'return_MA': {}}                                                                                                                          | {'querytype': {'證券代號：': 'querytype=1&stockNo=', '分類：創新板股票': 'querytype=2&selectType=TIB', '分類：水泥工業': 'querytype=2&selectType=01', '分類：食品工業': 'querytype=2&selectType=02', '分類：塑膠工業': 'querytype=2&selectType=03', '分類：紡織纖維': 'querytype=2&selectType=04', '分類：電機機械': 'querytype=2&selectType=05', '分類：電器電纜': 'querytype=2&selectType=06', '分類：化學生技醫療': 'querytype=2&selectType=07', '分類：化學工業': 'querytype=2&selectType=21', '分類：生技醫療業': 'querytype=2&selectType=22', '分類：玻璃陶瓷': 'querytype=2&selectType=08', '分類：造紙工業': 'querytype=2&selectType=09', '分類：鋼鐵工業': 'querytype=2&selectType=10', '分類：橡膠工業': 'querytype=2&selectType=11', '分類：汽車工業': 'querytype=2&selectType=12', '分類：電子工業': 'querytype=2&selectType=13', '分類：半導體業': 'querytype=2&selectType=24', '分類：電腦及週邊設備業': 'querytype=2&selectType=25', '分類：光電業': 'querytype=2&selectType=26', '分類：通信網路業': 'querytype=2&selectType=27', '分類：電子零組件業': 'querytype=2&selectType=28', '分類：電子通路業': 'querytype=2&selectType=29', '分類：資訊服務業': 'querytype=2&selectType=30', '分類：其他電子業': 'querytype=2&selectType=31', '分類：建材營造': 'querytype=2&selectType=14', '分類：航運業': 'querytype=2&selectType=15', '分類：觀光餐旅': 'querytype=2&selectType=16', '分類：金融保險': 'querytype=2&selectType=17', '分類：貿易百貨': 'querytype=2&selectType=18', '分類：油電燃氣業': 'querytype=2&selectType=23', '分類：綜合企業': 'querytype=2&selectType=19', '分類：綠能環保': 'querytype=2&selectType=35', '分類：數位雲端': 'querytype=2&selectType=36', '分類：運動休閒': 'querytype=2&selectType=37', '分類：居家生活': 'querytype=2&selectType=38', '分類：其他': 'querytype=2&selectType=20', '全部上市證券': 'querytype=3'}}                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     | 日期區間迭代單一下拉式選單或股票輸入格！<br>-> interval | https://www.twse.com.tw/rwd/zh/afterTrading/TWTAWU?startDate=20111003&endDate=20240926&querytype=1&stockNo=1101           |
| [上市公司>>上市公司條件選股](https://www.twse.com.tw/zh/listed/selection-criteria.html)                       | {'item=1': '指標項目：收盤價', 'item=2': '指標項目：成交量', 'item=3': '指標項目：三大法人', 'item=4': '指標項目：融資融券', 'item=5': '指標項目：月營收成長率', 'item=6': '指標項目：上市公司月週轉率'}                                                                                                                           | {'item=1': {'query=0': '查詢條件：股價漲幅前 50 名', 'query=1': '查詢條件：股價跌幅前 50 名'}, 'item=2': {'query=0': '查詢條件：成交量前 50 名', 'query=1': '查詢條件：成交量增加前 50 名', 'query=2': '查詢條件：成交量縮減前 50 名', 'query=3': '查詢條件：成交量增加幅度前 50 名', 'query=4': '查詢條件：成交量縮減幅度前 50 名'}, 'item=3': {'query=0': '查詢條件：投信買超前 50 名', 'query=1': '查詢條件：投信賣超前 50 名', 'query=2': '查詢條件：自營商買超前 50 名', 'query=3': '查詢條件：自營商賣超前 50 名', 'query=4': '查詢條件：外資及陸資買超前 50 名', 'query=5': '查詢條件：外資及陸資賣超前 50 名'}, 'item=4': {'query=0': '查詢條件：融資增加張數前 50 名', 'query=1': '查詢條件：融資減少張數前 50 名', 'query=2': '查詢條件：融券增加張數前 50 名', 'query=3': '查詢條件：融券減少張數前 50 名'}, 'item=5': {'query=0': '查詢條件：與上個月相差 10% 以上且未達 20%', 'query=1': '查詢條件：與上個月相差 20% 以上且未達 30%', 'query=2': '查詢條件：與上個月相差 30% 以上', 'query=3': '查詢條件：與去年同期相差 10% 以上且未達 20%', 'query=4': '查詢條件：與去年同期相差 20% 以上且未達 30%', 'query=5': '查詢條件：與去年同期相差 30% 以上'}, 'item=6': {'query=0': '查詢條件：月週轉率前 50 名'}}                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          | 例外處理網頁<br>-> exception url          | https://www.twse.com.tw/rwd/zh/inquiry/selection?item=1&query=0&response=json&_=1047433216615                             |
| [產品與服務>>ETF受理申報案件情形](https://www.twse.com.tw/zh/products/etf-registration-processing-status.html) | {'return_D': {}, 'return_M': {}, 'return_Y': {}, 'return_W': {}, 'return_A': {}, 'return_MA': {}}                                                                                                                                                                        | {'year': {'請選擇年份：全部': 'year=', '請選擇年份：民國113年': 'year=2024'}, 'companyName': {'請選擇公司名稱：全部': 'companyName=', '請選擇公司名稱：元大證券投資信託股份有限公司': 'companyName=元大證券投資信託股份有限公司', '請選擇公司名稱：國泰證券投資信託股份有限公司': 'companyName=國泰證券投資信託股份有限公司', '請選擇公司名稱：台新證券投資信託股份有限公司': 'companyName=台新證券投資信託股份有限公司', '請選擇公司名稱：富邦證券投資信託股份有限公司': 'companyName=富邦證券投資信託股份有限公司', '請選擇公司名稱：兆豐國際證券投資信託股份有限公司': 'companyName=兆豐國際證券投資信託股份有限公司', '請選擇公司名稱：野村證券投資信託股份有限公司': 'companyName=野村證券投資信託股份有限公司', '請選擇公司名稱：中國信託證券投資信託股份有限公司': 'companyName=中國信託證券投資信託股份有限公司', '請選擇公司名稱：群益證券投資信託股份有限公司': 'companyName=群益證券投資信託股份有限公司', '請選擇公司名稱：復華證券投資信託股份有限公司': 'companyName=復華證券投資信託股份有限公司', '請選擇公司名稱：凱基證券投資信託股份有限公司': 'companyName=凱基證券投資信託股份有限公司'}, 'category': {'請選擇案件類別：全部': 'category=', '請選擇案件類別：首次募集': 'category=First', '請選擇案件類別：追加募集': 'category=Additional'}, 'investmentPlace': {'請選擇投資地：全部': 'investmentPlace=', '請選擇投資地：國內': 'investmentPlace=Domestic', '請選擇投資地：國內外': 'investmentPlace=Foreign'}}                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             | 沒有日期選單，四個下拉式選單或股票輸入格！<br>-> none    | https://www.twse.com.tw/rwd/zh/etfRegistrationProcessingStatus/etfList?&year=&companyName=&category=&investmentPlace=     |
| [市場公告>>公布處置有價證券](https://www.twse.com.tw/zh/announcement/punish.html)                             | {'return_D': {'startDate': '20010101', 'endDate': '20240926'}, 'return_M': {}, 'return_Y': {}, 'return_W': {}, 'return_A': {}, 'return_MA': {}}                                                                                                                          | {'querytype': {'查詢範圍：全部': 'querytype=3', '查詢範圍：有價證券代碼(瀏覽)': 'querytype=1&stockNo=', '查詢範圍：類股：水泥工業': 'querytype=2&selectType=01', '查詢範圍：類股：食品工業': 'querytype=2&selectType=02', '查詢範圍：類股：塑膠工業': 'querytype=2&selectType=03', '查詢範圍：類股：紡織纖維': 'querytype=2&selectType=04', '查詢範圍：類股：電機機械': 'querytype=2&selectType=05', '查詢範圍：類股：電器電纜': 'querytype=2&selectType=06', '查詢範圍：類股：化學生技醫療': 'querytype=2&selectType=07', '查詢範圍：類股：化學工業': 'querytype=2&selectType=21', '查詢範圍：類股：生技醫療業': 'querytype=2&selectType=22', '查詢範圍：類股：玻璃陶瓷': 'querytype=2&selectType=08', '查詢範圍：類股：造紙工業': 'querytype=2&selectType=09', '查詢範圍：類股：鋼鐵工業': 'querytype=2&selectType=10', '查詢範圍：類股：橡膠工業': 'querytype=2&selectType=11', '查詢範圍：類股：汽車工業': 'querytype=2&selectType=12', '查詢範圍：類股：電子工業': 'querytype=2&selectType=13', '查詢範圍：類股：半導體業': 'querytype=2&selectType=24', '查詢範圍：類股：電腦及週邊設備業': 'querytype=2&selectType=25', '查詢範圍：類股：光電業': 'querytype=2&selectType=26', '查詢範圍：類股：通信網路業': 'querytype=2&selectType=27', '查詢範圍：類股：電子零組件業': 'querytype=2&selectType=28', '查詢範圍：類股：電子通路業': 'querytype=2&selectType=29', '查詢範圍：類股：資訊服務業': 'querytype=2&selectType=30', '查詢範圍：類股：其他電子業': 'querytype=2&selectType=31', '查詢範圍：類股：建材營造': 'querytype=2&selectType=14', '查詢範圍：類股：航運業': 'querytype=2&selectType=15', '查詢範圍：類股：觀光餐旅': 'querytype=2&selectType=16', '查詢範圍：類股：金融保險': 'querytype=2&selectType=17', '查詢範圍：類股：貿易百貨': 'querytype=2&selectType=18', '查詢範圍：類股：油電燃氣業': 'querytype=2&selectType=23', '查詢範圍：類股：綜合企業': 'querytype=2&selectType=19', '查詢範圍：類股：綠能環保': 'querytype=2&selectType=35', '查詢範圍：類股：數位雲端': 'querytype=2&selectType=36', '查詢範圍：類股：運動休閒': 'querytype=2&selectType=37', '查詢範圍：類股：居家生活': 'querytype=2&selectType=38', '查詢範圍：類股：其他': 'querytype=2&selectType=20'}, 'proceType': {'處置措施：請選擇': 'proceType=', '處置措施：督導會報決議': 'proceType=pt1', '處置措施：人工管制撮合': 'proceType=pt2', '處置措施：第二次處置': 'proceType=pt3', '處置措施：監視業務督導會報處置': 'proceType=pt4', '處置措施：限制券商申報': 'proceType=pt5', '處置措施：收足全部款券': 'proceType=pt6', '處置措施：收足五成款券': 'proceType=pt7', '處置措施：第一次處置': 'proceType=pt8'}, 'remarkType': {'處置條件：請選擇': 'remarkType=', '處置條件：最近三十個營業日已有十二次': 'remarkType=rt1', '處置條件：連續三次': 'remarkType=rt2', '處置條件：監視業務督導會報決議': 'remarkType=rt3', '處置條件：連續五次': 'remarkType=rt4', '處置條件：最近十個營業日已有六次': 'remarkType=rt5', '處置條件：連續三次及當日沖銷標準': 'remarkType=rt6', '處置條件：連續五次及當日沖銷標準': 'remarkType=rt7'}, 'sortKind': {'排序方式：依日期排序': 'sortKind=DATE', '排序方式：依有價證券代號排序': 'sortKind=STKNO'}} | 日期區間迭代三個下拉式選單或股票輸入格！<br>-> interval | https://www.twse.com.tw/rwd/zh/announcement/punish?startDate=20010101&endDate=20240926&querytype=3&proceType=&remarkType= |
| [焦點專區>>公告/活動>>上市普通股股數／TDR單位數增減公告 ](https://www.twse.com.tw/zh/focus/lt185-dtr.html)               | {'return_D': {'startDate1': '20100101', 'endDate1': '20240926'}, 'return_M': {}, 'return_Y': {}, 'return_W': {}, 'return_A': {}, 'return_MA': {}}                                                                                                                        | {'selectType': {'申報種類：': 'selectType=', '申報種類：(季申報)轉換公司債轉換普通股上市股數': 'selectType=1', '申報種類：(季申報)行使員工認股權所發行普通股上市': 'selectType=2', '申報種類：(不定期申報)註銷買回股票(庫藏股)': 'selectType=3', '申報種類：(不定期申報)註銷收回股票(限制員工權利新股)': 'selectType=4', '申報種類：(月申報)TDR額度內再發行': 'selectType=5', '申報種類：(不定期申報)註銷買回TDR': 'selectType=6', '申報種類：(季申報)特別股轉換普通股上市股數': 'selectType=7', '申報種類：(首次轉換)國內(海外)有價證券首次轉換': 'selectType=8', '申報種類：(首次行使)員工認股權憑證首次行使': 'selectType=9', '申報種類：(股票上市)增資新股上市': 'selectType=10', '申報種類：(股票上市)限制員工權利新股上市': 'selectType=11', '申報種類：(股票上市)私募普通股股票上市': 'selectType=12', '申報種類：(股票上市)普通股股款繳納憑證終止上市，增資股股票上市': 'selectType=13', '申報種類：(股票上市)新股權利證書終止上市，增資股股票上市': 'selectType=14', '申報種類：股款繳納憑證上市': 'selectType=15', '申報種類：新股權利證書上市': 'selectType=16', '申報種類：減資新股上市': 'selectType=17', '申報種類：TDR增發上市(參與發行)：現金增資/已發行股份': 'selectType=18', '申報種類：TDR增發上市(參與發行)：現金增資發行原股東有優先認購權之新股/以股代息/無償配股': 'selectType=19', '申報種類：更名新股上市': 'selectType=20', '申報種類：面額變更新股上市': 'selectType=22', '申報種類：(股票上市)特別股股款繳納憑證下市，特別股增資股票上市': 'selectType=21'}, 'stockNo': {'公司代號：': 'stockNo='}}                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            | 日期區間迭代兩個下拉式選單或股票輸入格！<br>-> interval | https://www.twse.com.tw/rwd/zh/announcement/LT185?startDate1=20100101&endDate1=20240926&selectType=&stockNo=1101          |
| [交易資訊>>三大法人>>三大法人買賣金額統計表](https://www.twse.com.tw/zh/trading/foreign/bfi82u.html)                 | 'return_D': {'type': 'day', 'dayDate': '20240926', 'label0': '日報表：'}, 'return_M': {'type': 'month', 'monthDate': '20240926', 'label2': '月報表：'}, 'return_Y': {}, 'return_W': {'type': 'week', 'weekDate': '20240923', 'label1': '週報表：'}, 'return_A': {}, 'return_MA': {}} | {}                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        | 總共有三個日期選項 - 月、週、日 <br>-> MVD        | https://www.twse.com.tw/rwd/zh/fund/BFI82U?type=day&dayDate=20240926                                                      |
